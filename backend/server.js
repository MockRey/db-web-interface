require('dotenv').config();

const express = require('express');
const cors = require('cors');
const { Pool } = require('pg');

const app = express();
const port = process.env.PORT || 3000;

app.use(cors()); // Ð Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÐ¼ CORS Ð´Ð»Ñ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð°
app.use(express.json()); // ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÐµÑ€Ð²ÐµÑ€Ñƒ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ JSON-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸

// Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿ÑƒÐ»Ð° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ Ðº PostgreSQL
const pool = new Pool({
    host: process.env.DB_HOST,
    port: process.env.DB_PORT,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME
});

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
pool.connect()
    .then(() => console.log('ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!'))
    .catch(err => console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…:', err));

console.log('Database Config:');
console.log('Host:', process.env.DB_HOST);
console.log('Port:', process.env.DB_PORT);
console.log('User:', process.env.DB_USER);
console.log('Database:', process.env.DB_NAME);

// Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ API
app.get('/', (req, res) => {
    res.send('API Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚! ðŸš€');
});

// Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð°
app.listen(port, () => {
    console.log(`âœ… Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° http://localhost:${port}`);
});

// Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
app.post('/query', async (req, res) => {
    try {
        const { sql } = req.body; // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¸Ð· Ñ‚ÐµÐ»Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
        if (!sql) { // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹
            return res.status(400).json({ error: 'SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼' });
        }

        // Ð—Ð°Ð¿Ñ€ÐµÑ‰Ñ‘Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
        const forbiddenCommands = ['DELETE', 'DROP', 'ALTER', 'TRUNCATE', 'UPDATE', 'INSERT'];
        const normalizedSQL = sql.trim().toUpperCase(); // ÐŸÑ€Ð¸Ð²Ð¾Ð´Ð¸Ð¼ Ðº Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼Ñƒ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñƒ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸

        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð»Ð¸ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð·Ð°Ð¿Ñ€ÐµÑ‰Ñ‘Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
        if (forbiddenCommands.some(cmd => normalizedSQL.startsWith(cmd))) {
            return res.status(403).json({ error: 'Ð—Ð°Ð¿Ñ€Ð¾Ñ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð·Ð°Ð¿Ñ€ÐµÑ‰Ñ‘Ð½Ð½ÑƒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ!' });
        }

        // Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¸ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ 100 ÑÑ‚Ñ€Ð¾ÐºÐ°Ð¼Ð¸
        const result = await pool.query(sql + ' LIMIT 100'); // Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…
        if (result.rowCount === 0) { // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
            return res.status(404).json({ error: 'ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ' }); // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ 404-ÑŽ Ð¾ÑˆÐ¸Ð±ÐºÑƒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
        }

        res.json({ data: result.rows }); // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ JSON; Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ data Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ Ðº Ð‘Ð”
    }
    
    catch (err) { // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
        console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°:', err); // Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ (Ð¡Ð•Ð Ð’Ð•Ð Ð!!! - Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð·Ð¸Ñ‚)
        res.status(500).json({ error: 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°' }); // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
    }
});

// Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° Ð²ÑÐµÑ… ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¾Ð² Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸
app.get('/templates', async (req, res) => { // ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ req Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ, Ð½Ð¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
    try {
        const result = await pool.query('SELECT * FROM sql_templates'); // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð²ÑÐµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹ Ð¸Ð· Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ sql_templates
        res.json({ templates: result.rows }); // Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ templates Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ Ðº Ð‘Ð”
    }
    
    catch (err) {
        console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ñ‹Ð³Ñ€ÑƒÐ·ÐºÐµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¾Ð²:', err);
        res.status(500).json({ error: 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ‹Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¾Ð²' });
    }
});

// Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
app.post('/templates', async (req, res) => {
    const { name, sql } = req.body; // Ð—Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ name Ð¸ sql Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¸Ð· Ñ‚ÐµÐ»Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°, Ð¿Ñ€Ð¸ÑˆÐµÐ´ÑˆÐµÐ³Ð¾ Ð¾Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
    
    if (!name || !sql) { // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¾Ð±Ð° Ð¿Ð¾Ð»Ñ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹
        return res.status(400).json({ error: 'Ð˜Ð¼Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° Ð¸ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹!' });
    }

    try {
        await pool.query('INSERT INTO sql_templates (name, sql) VALUES ($1, $2) RETURNING *', [name, sql]); // Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð² Ð±Ð°Ð·Ñƒ Ð½Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°
        res.status(201).json({ message: "Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½!" }); // 201 ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ñ€ÐµÑÑƒÑ€Ñ Ð±Ñ‹Ð» ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½; Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± ÑƒÑÐ¿ÐµÑ…Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
    }
    
    catch (err) {
        console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ð¸ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°:', err);
        res.status(500).json({ error: 'ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°' });
    }
});

// Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
app.delete('/templates/:id', async (req, res) => {
    
    const { id } = req.params; // Ð—Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ id Ð¿Ñ€Ð¸ÑˆÐµÐ´ÑˆÐµÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ id ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°

    try {
        const result = await pool.query("DELETE FROM sql_templates WHERE id = $1 RETURNING *", [id]); // Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð² Ð±Ð°Ð·Ñƒ Ð½Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¼ id
        if (result.rowCount === 0) { // ÐµÑÐ»Ð¸ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ñ€Ð¾ÑˆÑ‘Ð» ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ (ÑˆÐ°Ð±Ð»Ð¾Ð½ ÑƒÐ´Ð°Ð»Ñ‘Ð½), Ð¾Ð½ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑƒÐ´Ð°Ð»Ñ‘Ð½Ð½Ñ‹Ñ… ÑÑ‚Ñ€Ð¾Ðº; ÐµÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ rowCount Ð²ÐµÑ€Ð½ÑƒÐ»Ð° 0, Ñ‚Ð¾ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð½Ðµ Ð±Ñ‹Ð» Ð½Ð°Ð¹Ð´ÐµÐ½
            return res.status(404).json({ error: "Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" });
        }

        res.json({ message: "Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»Ñ‘Ð½" }); // Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± ÑƒÑÐ¿ÐµÑ…Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
    }
    
    catch (err) {
        console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°:", err);
        res.status(500).json({ error: "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°" });
    }
});

// Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ play_history Ð¸ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÑƒ
app.post('/player-stats', async (req, res) => {
    const { playerId, startDate, endDate, game } = req.body;
  
    try {
      // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð»Ð¸ Ñ‚Ð°ÐºÐ¾Ð¹ Ð¸Ð³Ñ€Ð¾Ðº
      const playerCheck = await pool.query('SELECT * FROM players WHERE player_id = $1', [playerId]);
      
      if (playerCheck.rowCount === 0) {
        return res.status(404).json({ error: 'Ð˜Ð³Ñ€Ð¾Ðº Ñ Ñ‚Ð°ÐºÐ¸Ð¼ ID Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½' });
      }
  
      // Ð¡Ñ‚Ñ€Ð¾Ð¸Ð¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸
      let query = `
        SELECT play_history.*, levels.game_id
        FROM play_history
        JOIN levels ON play_history.level_id = levels.level_id
        WHERE play_history.player_id = $1
          AND play_history.start_time >= $2
          AND play_history.end_time <= $3
      `;
      const params = [playerId, startDate, endDate];
  
      if (game !== 'all') {
        query += ` AND levels.game_id = $4`;
        params.push(game);
      }
  
      const result = await pool.query(query, params);
  
      if (result.rowCount === 0) {
        return res.status(404).json({ error: 'ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¼ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼' });
      }
  
      res.json({ stats: result.rows });
    } 
    
    catch (err) {
      console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ð¸ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°:', err);
      res.status(500).json({ error: 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°' });
    }
  });
  